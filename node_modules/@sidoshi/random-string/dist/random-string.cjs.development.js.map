{"version":3,"file":"random-string.cjs.development.js","sources":["../src/charset.ts","../src/index.ts"],"sourcesContent":["// Copyright (c) 2019 Siddharth Doshi\n//\n// This software is released under the MIT License.\n// https://opensource.org/licenses/MIT\n\ntype Charset =\n  | 'alphanumeric'\n  | 'alphabetic'\n  | 'loweralpha'\n  | 'upperalpha'\n  | 'numeric'\n  | 'hex'\n  | 'symbols';\n\ntype Charsets = {\n  [key in Charset]: string;\n};\n\nconst numbers = '0123456789';\nconst charsLower = 'abcdefghijklmnopqrstuvwxyz';\nconst charsUpper = charsLower.toUpperCase();\nconst hexChars = 'ABCDEF';\nconst symbols = '!@#$%^&*()<>?/[]{},.:;';\n\nexport const charsets: Charsets = {\n  alphanumeric: charsLower + charsUpper + numbers,\n  alphabetic: charsLower + charsUpper,\n  loweralpha: charsLower,\n  upperalpha: charsUpper,\n  numeric: numbers,\n  hex: hexChars + numbers,\n  symbols,\n};\n","// Copyright (c) 2019 Siddharth Doshi\n//\n// This software is released under the MIT License.\n// https://opensource.org/licenses/MIT\n\nimport randombytes from 'randombytes';\n\nimport { charsets } from './charset';\nexport { charsets } from './charset';\n\ninterface OptionsObject {\n  length?: number;\n  characters?: string;\n}\n\ntype Options = OptionsObject | number;\n\nconst MAX_CHARSET_SIZE = 0x10000;\n\nconst defaultOptions = {\n  length: 32,\n  characters: charsets.alphanumeric,\n};\n\nexport function randomstring(options?: number): string;\nexport function randomstring(options?: Options): string;\nexport function randomstring(options: Options | number = 32): string {\n  if (typeof options === 'number') {\n    options = {\n      length: options,\n    };\n  }\n\n  const result: string[] = [];\n  const opts = {\n    ...defaultOptions,\n    ...options,\n  };\n\n  if (opts.characters.length >= MAX_CHARSET_SIZE) {\n    throw new Error(\n      `Character set size should not increase ${MAX_CHARSET_SIZE}`\n    );\n  }\n\n  // Let c be `characters.length`.\n  // The closest number to MAX_CHARSET_SIZE that is divisible by `c`.\n  // We take the number that is a multiple of `c` so that each character from\n  // the set has an equal chance of being choosen.\n  const max = MAX_CHARSET_SIZE - (MAX_CHARSET_SIZE % opts.characters.length);\n\n  // Most of the time, the randomstring would be built in first inner loop.\n  // But on cases when multiple invalid selectors are found and we can't build\n  // the compelete string in first loop, we continue looping.\n  while (result.length < opts.length) {\n    // Ensure that the size of entropy is even because we are using 2 bytes\n    // for getting selectors. We use 16bit selectors so that it would allow\n    // generating random strings from bigger character sets.\n    // The size of entropy is also set to be a little longer than the requested\n    // length so that we have higher chances of generating the compelete string\n    // in one loop.\n    const entropy = randombytes(Math.ceil(1.1 * opts.length) * 2);\n\n    for (let i = 0; i < entropy.length && result.length < opts.length; i += 2) {\n      const selector = entropy.readUInt16BE(i);\n      if (selector > max) {\n        continue;\n      }\n      result.push(opts.characters[selector % opts.characters.length]);\n    }\n  }\n\n  return result.join('');\n}\n\nexport default randomstring;\n"],"names":["numbers","charsLower","charsUpper","toUpperCase","hexChars","symbols","charsets","alphanumeric","alphabetic","loweralpha","upperalpha","numeric","hex","MAX_CHARSET_SIZE","defaultOptions","length","characters","randomstring","options","result","opts","Error","max","entropy","randombytes","Math","ceil","i","selector","readUInt16BE","push","join"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AAkBA,IAAMA,OAAO,GAAG,YAAhB;AACA,IAAMC,UAAU,GAAG,4BAAnB;AACA,IAAMC,UAAU;;AAAGD,UAAU,CAACE,WAAX,EAAnB;AACA,IAAMC,QAAQ,GAAG,QAAjB;AACA,IAAMC,OAAO,GAAG,wBAAhB;AAEA,IAAaC,QAAQ,GAAa;EAChCC,YAAY,EAAEN,UAAU,GAAGC,UAAb,GAA0BF,OADR;EAEhCQ,UAAU,EAAEP,UAAU,GAAGC,UAFO;EAGhCO,UAAU,EAAER,UAHoB;EAIhCS,UAAU,EAAER,UAJoB;EAKhCS,OAAO,EAAEX,OALuB;EAMhCY,GAAG,EAAER,QAAQ,GAAGJ,OANgB;EAOhCK,OAAO,EAAPA;CAPK;;ACPP,IAAMQ,gBAAgB,GAAG,OAAzB;AAEA,IAAMC,cAAc,GAAG;EACrBC,MAAM,EAAE,EADa;EAErBC,UAAU,EAAEV,QAAQ,CAACC;CAFvB;AAOA,SAAgBU,aAAaC;MAAAA;IAAAA,UAA4B;;;MACnD,OAAOA,OAAP,KAAmB,QAAvB,EAAiC;IAC/BA,OAAO,GAAG;MACRH,MAAM,EAAEG;KADV;;;MAKIC,MAAM,GAAa,EAAzB;;MACMC,IAAI,gBACLN,cADK,MAELI,OAFK,CAAV;;MAKIE,IAAI,CAACJ,UAAL,CAAgBD,MAAhB,IAA0BF,gBAA9B,EAAgD;UACxC,IAAIQ,KAAJ,6CACsCR,gBADtC,CAAN;;;;;;;MASIS,GAAG,GAAGT,gBAAgB,GAAIA,gBAAgB,GAAGO,IAAI,CAACJ,UAAL,CAAgBD,MAAnE;;;;SAKOI,MAAM,CAACJ,MAAP,GAAgBK,IAAI,CAACL,MAA5B,EAAoC;;;;;;;QAO5BQ,OAAO,GAAGC,WAAW,CAACC,IAAI,CAACC,IAAL,CAAU,MAAMN,IAAI,CAACL,MAArB,IAA+B,CAAhC,CAA3B;;SAEK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,OAAO,CAACR,MAAZ,IAAsBI,MAAM,CAACJ,MAAP,GAAgBK,IAAI,CAACL,MAA3D,EAAmEY,CAAC,IAAI,CAAxE,EAA2E;UACnEC,QAAQ,GAAGL,OAAO,CAACM,YAAR,CAAqBF,CAArB,CAAjB;;UACIC,QAAQ,GAAGN,GAAf,EAAoB;;;;MAGpBH,MAAM,CAACW,IAAP,CAAYV,IAAI,CAACJ,UAAL,CAAgBY,QAAQ,GAAGR,IAAI,CAACJ,UAAL,CAAgBD,MAA3C,CAAZ;;;;SAIGI,MAAM,CAACY,IAAP,CAAY,EAAZ,CAAP;;;;;;;"}