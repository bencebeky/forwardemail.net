"use strict";

const fs = require('fs');

const path = require('path');

const {
  promisify
} = require('util');

const $ = require('cheerio');

const Lipo = require('lipo');

const TextToSvg = require('text-to-svg');

const _ = require('lodash');

const debug = require('debug')('custom-fonts-in-emails');

const isSANB = require('is-string-and-not-blank');

const levenshtein = require('fast-levenshtein');

const osFonts = require('os-fonts');

const pkgDir = require('pkg-dir');

const revisionHash = require('rev-hash');

const safeStringify = require('fast-safe-stringify');

const universalify = require('universalify');

const useTypes = ['user', 'local', 'network', 'system'];
const fontExtensions = ['otf', 'OTF', 'ttf', 'TTF', 'woff', 'WOFF'];
const customFontsCache = {};
const stat = promisify(fs.stat);
let defaults = {
  text: '',
  fontNameOrPath: 'Arial',
  fontSize: '24px',
  fontColor: '#000',
  backgroundColor: 'transparent',
  supportsFallback: true,
  resizeToFontSize: false,
  trim: false,
  trimTolerance: 10,
  attrs: {},
  textToSvg: {
    x: 0,
    y: 0,
    anchor: 'left top',
    attributes: {
      stroke: 'none'
    }
  }
};
const load = universalify.fromCallback(TextToSvg.load);

function setDefaults(options) {
  defaults = _.defaultsDeep(options, defaults);
  return defaults;
} // eslint-disable-next-line complexity


async function setOptions(options) {
  // Clone to prevent interference
  options = _.cloneDeep(options); // Set deep defaults

  options = _.defaultsDeep(options, defaults); // Ensure `text` is a string

  if (!_.isString(options.text)) throw new Error('`text` must be a String'); // Ensure `fontNameOrPath` is a string and not blank

  if (!isSANB(options.fontNameOrPath)) throw new Error('`fontNameOrPath` must be a String and not blank'); // Convert font size in pixels to number
  // and remove px, so we just convert to digits only

  if (_.isString(options.fontSize)) options.fontSize = parseFloat(options.fontSize); // Round to nearest whole pixel

  options.fontSize = Math.round(options.fontSize); // Ensure it's a number greater than 0

  if (!_.isNumber(options.fontSize) || options.fontSize <= 0) throw new Error('`fontSize` must be a Number or String that is a valid number > than 0'); // Ensure `fontColor` is a string

  if (!isSANB(options.fontColor)) throw new Error('`fontColor` must be a String and not blank'); // Ensure `backgroundColor` is a string

  if (!isSANB(options.backgroundColor)) throw new Error('`backgroundColor` must be a String and not blank'); // Ensure supportsFallback is a boolean else true

  if (!_.isBoolean(options.supportsFallback)) throw new Error('`supportsFallback` must be a Boolean'); // Ensure resizeToFontSize is a boolean else true

  if (!_.isBoolean(options.resizeToFontSize)) throw new Error('`resizeToFontSize` must be a Boolean'); // Ensure trim is a boolean else true

  if (!_.isBoolean(options.trim)) throw new Error('`trim` must be a Boolean'); // Ensure trimTolerance is a number else 10

  if (!_.isNumber(options.trimTolerance) || options.trimTolerance < 1 || options.trimTolerance > 99) throw new Error('`trimTolerance` must be a Number between 1 and 99 inclusive'); // If `textToSvg.attributes.fill` is not set
  // then set it equal to `fontColor`

  if (!_.isString(options.textToSvg.attributes.fill)) options.textToSvg.attributes.fill = options.fontColor; // If `textToSvg.fontSize` not set, then we will calculate
  // what the `fontSize` should be based off height of font

  if (!_.isNumber(options.textToSvg.fontSize)) options.textToSvg.fontSize = options.fontSize; // If `fontNameOrPath` was not a valid font path (with smart detection)
  // then result to use `getClosestFontName` and `getFontPathByName`

  const ext = path.extname(options.fontNameOrPath);
  const fontName = path.basename(options.fontNameOrPath, ext);

  if (_.includes(fontExtensions, ext)) {
    const stats = await stat(path.resolve(options.fontNameOrPath));
    if (!stats.isFile()) throw new Error(`${path.resolve(options.fontNameOrPath)} was not a valid file`);
    options.fontPath = path.resolve(options.fontNameOrPath);
    options.fontName = fontName;
  } else {
    const fontDir = path.dirname(path.resolve(options.fontNameOrPath));
    let data = await Promise.all(fontExtensions.map(async ext => {
      const filePath = `${fontDir}/${fontName}.${ext}`;

      try {
        const stats = await stat(filePath);
        return stats.isFile() ? filePath : false;
      } catch (_unused) {
        return false;
      }
    })); // Remove false matches

    data = _.compact(data); // If this was a directory path then throw an error that it was not found

    if (options.fontNameOrPath.includes(path.sep) && data.length === 0) throw new Error(`\`fontNameOrPath\` "${options.fontNameOrPath}" file was not found`);

    if (data.length > 0) {
      options.fontName = fontName;
      options.fontPath = data[0];
    } else {
      options.fontName = await getClosestFontName(options.fontNameOrPath);
      options.fontPath = await getFontPathByName(options.fontName);
    }
  }

  return options;
} // eslint-disable-next-line max-params


function renderFallback(text, fontSize, fontColor, backgroundColor, attrs) {
  attrs.title = text;
  attrs.alt = text;
  attrs.style = attrs.style || '';
  attrs.style += `color: ${fontColor};`;
  attrs.style += `font-size: ${fontSize / 2}px;`;
  attrs.style += `line-height: ${fontSize}px;`;
  attrs.style += 'text-align: center;';
  attrs.style += `background-color: ${backgroundColor};`;
  return attrs;
}

function applyAttributes($el, attrs) {
  _.each(_.keys(attrs), key => {
    $el.attr(key, attrs[key]);
  });

  return $el;
}

async function svg(options) {
  options = await setOptions(options);
  const hash = revisionHash(`svg:${safeStringify(options)}`);

  if (customFontsCache[hash]) {
    debug(`found customFontsCache result for ${hash}`, customFontsCache[hash]);
    return customFontsCache[hash];
  }

  const textToSvg = await load(options.fontPath);
  const str = textToSvg.getSVG(options.text, options.textToSvg);
  let $svg = $(str);
  const $rect = $('<rect>');
  $rect.attr('width', $svg.attr('width'));
  $rect.attr('height', $svg.attr('height'));
  $rect.attr('fill', options.backgroundColor);
  $svg.prepend($rect);
  $svg.attr('width', Math.round(parseFloat($svg.attr('width'))));
  $svg.attr('height', Math.round(parseFloat($svg.attr('height'))));
  $svg.attr('viewBox', `0 0 ${$svg.attr('width')} ${$svg.attr('height')}`);
  $svg = applyAttributes($svg, options.attrs);
  const result = $.html($svg);
  customFontsCache[hash] = result;
  debug(`caching result for ${hash}`, customFontsCache[hash]);
  return result;
}

async function img(options) {
  options = await setOptions(options);
  const hash = revisionHash(`img:${safeStringify(options)}`);

  if (customFontsCache[hash]) {
    debug(`found customFontsCache result for ${hash}`, customFontsCache[hash]);
    return customFontsCache[hash];
  }

  const str = await svg(options);
  const $svg = $(str);
  let $img = $('<img>');
  $img.attr('width', $svg.attr('width'));
  $img.attr('height', $svg.attr('height'));
  $img.attr('src', `data:image/svg+xml;base64,${Buffer.from(str, 'utf8').toString('base64')}`);
  if (options.supportsFallback) options.attrs = renderFallback(options.text, $svg.attr('height'), options.fontColor, options.backgroundColor, options.attrs);
  $img = applyAttributes($img, options.attrs);
  const result = $.html($img);
  customFontsCache[hash] = result;
  debug(`caching result for ${hash}`, result);
  return result;
}

async function png(options, scale) {
  // Default scale it 1
  scale = scale || 1;
  if (!_.isNumber(scale)) throw new Error('`scale` must be a Number');
  options = await setOptions(options); //
  // initially I tried to use the package `svgo`
  // to optimize the image and remove invisible whitespace
  // but this feature isn't available yet
  // https://github.com/svg/svgo/issues/67
  //
  // also I used Sharp directly, but then created Lipo
  // to alleviate the need for developers to install libvips or worry
  // about installing extra dependencies on their system
  // but still allow them to use the brilliance of Sharp
  //

  const {
    fontSize
  } = options;
  options.fontSize = Math.round(fontSize * scale);
  options.textToSvg.fontSize = options.fontSize;
  const hash = revisionHash(`png:${safeStringify(options)}`);

  if (customFontsCache[hash]) {
    debug(`found customFontsCache result for ${hash}`, customFontsCache[hash]);
    return customFontsCache[hash];
  }

  const str = await svg(options);
  const buf = Buffer.from(str, 'utf8');
  const getImage = new Lipo()(buf);
  if (options.trim) getImage.trim(options.trimTolerance);
  if (options.resizeToFontSize) getImage.resize(null, Math.round(fontSize * scale));
  const imageBuffer = await getImage.png().toBuffer();
  const metadata = await new Lipo()(imageBuffer).metadata();
  let $img = $('<img>');
  $img.attr('width', Math.round(metadata.width / scale));
  $img.attr('height', Math.round(metadata.height / scale));
  $img.attr('src', `data:image/png;base64,${imageBuffer.toString('base64')}`);
  if (options.supportsFallback) options.attrs = renderFallback(options.text, Math.round(metadata.height / scale), options.fontColor, options.backgroundColor, options.attrs);
  $img = applyAttributes($img, options.attrs);
  const result = $.html($img);
  customFontsCache[hash] = result;
  debug(`caching result for ${hash}`, result);
  return result;
}

async function png2x(options) {
  return png(options, 2);
}

async function png3x(options) {
  return png(options, 3);
}

async function getClosestFontName(fontNameOrPath) {
  const hash = `closestFontName(${fontNameOrPath})`;
  if (customFontsCache[hash]) return customFontsCache[hash];
  const fontNames = await getAvailableFontNames();

  const fontNamesByDistance = _.sortBy(_.map(fontNames, name => {
    return {
      name,
      distance: levenshtein.get(fontNameOrPath.toLowerCase(), name.toLowerCase())
    };
  }), ['distance', 'name']); // If there were no matches or if the distance
  // of character difference is 50% different
  // than actual length of the font name, then reject it


  if (fontNamesByDistance.length === 0 || fontNamesByDistance[0].distance > fontNameOrPath.length / 2) throw new Error(`"${fontNameOrPath}" was not found, did you forget to install it?`);
  customFontsCache[hash] = fontNamesByDistance[0].name;
  return fontNamesByDistance[0].name;
}

async function getFontPathByName(name) {
  const hash = `fontPathByName(${name})`;
  if (customFontsCache[hash]) return customFontsCache[hash];
  const fontPathsByName = await getFontPathsByName();
  customFontsCache[hash] = fontPathsByName[name];
  return fontPathsByName[name];
}

async function getFontPathsByName() {
  if (customFontsCache.fontPathsByName) return customFontsCache.fontPathsByName;
  const fontNames = await getAvailableFontNames();
  const fontPaths = await getAvailableFontPaths();

  const fontPathsByName = _.zipObject(fontNames, fontPaths);

  customFontsCache.fontPathsByName = fontPathsByName;
  return fontPathsByName;
}

async function getAvailableFontPaths() {
  if (customFontsCache.fontPaths) return customFontsCache.fontPaths;
  let fonts = await Promise.all(useTypes.map(type => osFonts.getAll(type)));
  fonts = _.flatten(fonts);
  const arr = []; // add fonts from system

  for (const element of fonts) {
    let ext = path.extname(element);
    if (ext.indexOf('.') === 0) ext = ext.slice(1);
    if (fontExtensions.includes(ext)) arr.push(element);
  } // add node_modules folder


  const nodeModuleFonts = await osFonts.getFontsInDirectory(path.join(pkgDir.sync(), 'node_modules'));

  for (const element of nodeModuleFonts) {
    let ext = path.extname(element);
    if (ext.indexOf('.') === 0) ext = ext.slice(1);
    if (fontExtensions.includes(ext)) arr.push(element);
  } // Sort the fonts A-Z


  const fontPaths = arr.sort();
  customFontsCache.fontPaths = fontPaths;
  return fontPaths;
}

async function getAvailableFontNames() {
  if (customFontsCache.fontNames) return customFontsCache.fontNames;
  const fontPaths = await getAvailableFontPaths();

  const fontNames = _.map(fontPaths, fontPath => path.basename(fontPath, path.extname(fontPath)));

  customFontsCache.fontNames = fontNames;
  return fontNames;
}

module.exports = {
  setDefaults,
  setOptions,
  svg,
  img,
  png,
  png2x,
  png3x,
  getClosestFontName,
  getFontPathsByName,
  getFontPathByName,
  getAvailableFontPaths,
  getAvailableFontNames,
  customFontsCache
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJwYXRoIiwicHJvbWlzaWZ5IiwiJCIsIkxpcG8iLCJUZXh0VG9TdmciLCJfIiwiZGVidWciLCJpc1NBTkIiLCJsZXZlbnNodGVpbiIsIm9zRm9udHMiLCJwa2dEaXIiLCJyZXZpc2lvbkhhc2giLCJzYWZlU3RyaW5naWZ5IiwidW5pdmVyc2FsaWZ5IiwidXNlVHlwZXMiLCJmb250RXh0ZW5zaW9ucyIsImN1c3RvbUZvbnRzQ2FjaGUiLCJzdGF0IiwiZGVmYXVsdHMiLCJ0ZXh0IiwiZm9udE5hbWVPclBhdGgiLCJmb250U2l6ZSIsImZvbnRDb2xvciIsImJhY2tncm91bmRDb2xvciIsInN1cHBvcnRzRmFsbGJhY2siLCJyZXNpemVUb0ZvbnRTaXplIiwidHJpbSIsInRyaW1Ub2xlcmFuY2UiLCJhdHRycyIsInRleHRUb1N2ZyIsIngiLCJ5IiwiYW5jaG9yIiwiYXR0cmlidXRlcyIsInN0cm9rZSIsImxvYWQiLCJmcm9tQ2FsbGJhY2siLCJzZXREZWZhdWx0cyIsIm9wdGlvbnMiLCJkZWZhdWx0c0RlZXAiLCJzZXRPcHRpb25zIiwiY2xvbmVEZWVwIiwiaXNTdHJpbmciLCJFcnJvciIsInBhcnNlRmxvYXQiLCJNYXRoIiwicm91bmQiLCJpc051bWJlciIsImlzQm9vbGVhbiIsImZpbGwiLCJleHQiLCJleHRuYW1lIiwiZm9udE5hbWUiLCJiYXNlbmFtZSIsImluY2x1ZGVzIiwic3RhdHMiLCJyZXNvbHZlIiwiaXNGaWxlIiwiZm9udFBhdGgiLCJmb250RGlyIiwiZGlybmFtZSIsImRhdGEiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiZmlsZVBhdGgiLCJjb21wYWN0Iiwic2VwIiwibGVuZ3RoIiwiZ2V0Q2xvc2VzdEZvbnROYW1lIiwiZ2V0Rm9udFBhdGhCeU5hbWUiLCJyZW5kZXJGYWxsYmFjayIsInRpdGxlIiwiYWx0Iiwic3R5bGUiLCJhcHBseUF0dHJpYnV0ZXMiLCIkZWwiLCJlYWNoIiwia2V5cyIsImtleSIsImF0dHIiLCJzdmciLCJoYXNoIiwic3RyIiwiZ2V0U1ZHIiwiJHN2ZyIsIiRyZWN0IiwicHJlcGVuZCIsInJlc3VsdCIsImh0bWwiLCJpbWciLCIkaW1nIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwicG5nIiwic2NhbGUiLCJidWYiLCJnZXRJbWFnZSIsInJlc2l6ZSIsImltYWdlQnVmZmVyIiwidG9CdWZmZXIiLCJtZXRhZGF0YSIsIndpZHRoIiwiaGVpZ2h0IiwicG5nMngiLCJwbmczeCIsImZvbnROYW1lcyIsImdldEF2YWlsYWJsZUZvbnROYW1lcyIsImZvbnROYW1lc0J5RGlzdGFuY2UiLCJzb3J0QnkiLCJuYW1lIiwiZGlzdGFuY2UiLCJnZXQiLCJ0b0xvd2VyQ2FzZSIsImZvbnRQYXRoc0J5TmFtZSIsImdldEZvbnRQYXRoc0J5TmFtZSIsImZvbnRQYXRocyIsImdldEF2YWlsYWJsZUZvbnRQYXRocyIsInppcE9iamVjdCIsImZvbnRzIiwidHlwZSIsImdldEFsbCIsImZsYXR0ZW4iLCJhcnIiLCJlbGVtZW50IiwiaW5kZXhPZiIsInNsaWNlIiwicHVzaCIsIm5vZGVNb2R1bGVGb250cyIsImdldEZvbnRzSW5EaXJlY3RvcnkiLCJqb2luIiwic3luYyIsInNvcnQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLEVBQUUsR0FBR0MsT0FBTyxDQUFDLElBQUQsQ0FBbEI7O0FBQ0EsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsTUFBRCxDQUFwQjs7QUFDQSxNQUFNO0FBQUVFLEVBQUFBO0FBQUYsSUFBZ0JGLE9BQU8sQ0FBQyxNQUFELENBQTdCOztBQUVBLE1BQU1HLENBQUMsR0FBR0gsT0FBTyxDQUFDLFNBQUQsQ0FBakI7O0FBQ0EsTUFBTUksSUFBSSxHQUFHSixPQUFPLENBQUMsTUFBRCxDQUFwQjs7QUFDQSxNQUFNSyxTQUFTLEdBQUdMLE9BQU8sQ0FBQyxhQUFELENBQXpCOztBQUNBLE1BQU1NLENBQUMsR0FB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UDtBQUNEOztBQUVEMkIsTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBQ2ZsRyxFQUFBQSxXQURlO0FBRWZHLEVBQUFBLFVBRmU7QUFHZnlDLEVBQUFBLEdBSGU7QUFJZlMsRUFBQUEsR0FKZTtBQUtmSyxFQUFBQSxHQUxlO0FBTWZVLEVBQUFBLEtBTmU7QUFPZkMsRUFBQUEsS0FQZTtBQVFmckMsRUFBQUEsa0JBUmU7QUFTZitDLEVBQUFBLGtCQVRlO0FBVWY5QyxFQUFBQSxpQkFWZTtBQVdmZ0QsRUFBQUEscUJBWGU7QUFZZlYsRUFBQUEscUJBWmU7QUFhZjVGLEVBQUFBO0FBYmUsQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgeyBwcm9taXNpZnkgfSA9IHJlcXVpcmUoJ3V0aWwnKTtcblxuY29uc3QgJCA9IHJlcXVpcmUoJ2NoZWVyaW8nKTtcbmNvbnN0IExpcG8gPSByZXF1aXJlKCdsaXBvJyk7XG5jb25zdCBUZXh0VG9TdmcgPSByZXF1aXJlKCd0ZXh0LXRvLXN2ZycpO1xuY29uc3QgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xuY29uc3QgZGVidWcgPSByZXF1aXJlKCdkZWJ1ZycpKCdjdXN0b20tZm9udHMtaW4tZW1haWxzJyk7XG5jb25zdCBpc1NBTkIgPSByZXF1aXJlKCdpcy1zdHJpbmctYW5kLW5vdC1ibGFuaycpO1xuY29uc3QgbGV2ZW5zaHRlaW4gPSByZXF1aXJlKCdmYXN0LWxldmVuc2h0ZWluJyk7XG5jb25zdCBvc0ZvbnRzID0gcmVxdWlyZSgnb3MtZm9udHMnKTtcbmNvbnN0IHBrZ0RpciA9IHJlcXVpcmUoJ3BrZy1kaXInKTtcbmNvbnN0IHJldmlzaW9uSGFzaCA9IHJlcXVpcmUoJ3Jldi1oYXNoJyk7XG5jb25zdCBzYWZlU3RyaW5naWZ5ID0gcmVxdWlyZSgnZmFzdC1zYWZlLXN0cmluZ2lmeScpO1xuY29uc3QgdW5pdmVyc2FsaWZ5ID0gcmVxdWlyZSgndW5pdmVyc2FsaWZ5Jyk7XG5cbmNvbnN0IHVzZVR5cGVzID0gWyd1c2VyJywgJ2xvY2FsJywgJ25ldHdvcmsnLCAnc3lzdGVtJ107XG5jb25zdCBmb250RXh0ZW5zaW9ucyA9IFsnb3RmJywgJ09URicsICd0dGYnLCAnVFRGJywgJ3dvZmYnLCAnV09GRiddO1xuY29uc3QgY3VzdG9tRm9udHNDYWNoZSA9IHt9O1xuXG5jb25zdCBzdGF0ID0gcHJvbWlzaWZ5KGZzLnN0YXQpO1xuXG5sZXQgZGVmYXVsdHMgPSB7XG4gIHRleHQ6ICcnLFxuICBmb250TmFtZU9yUGF0aDogJ0FyaWFsJyxcbiAgZm9udFNpemU6ICcyNHB4JyxcbiAgZm9udENvbG9yOiAnIzAwMCcsXG4gIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgc3VwcG9ydHNGYWxsYmFjazogdHJ1ZSxcbiAgcmVzaXplVG9Gb250U2l6ZTogZmFsc2UsXG4gIHRyaW06IGZhbHNlLFxuICB0cmltVG9sZXJhbmNlOiAxMCxcbiAgYXR0cnM6IHt9LFxuICB0ZXh0VG9Tdmc6IHtcbiAgICB4OiAwLFxuICAgIHk6IDAsXG4gICAgYW5jaG9yOiAnbGVmdCB0b3AnLFxuICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgIHN0cm9rZTogJ25vbmUnXG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBsb2FkID0gdW5pdmVyc2FsaWZ5LmZyb21DYWxsYmFjayhUZXh0VG9TdmcubG9hZCk7XG5cbmZ1bmN0aW9uIHNldERlZmF1bHRzKG9wdGlvbnMpIHtcbiAgZGVmYXVsdHMgPSBfLmRlZmF1bHRzRGVlcChvcHRpb25zLCBkZWZhdWx0cyk7XG4gIHJldHVybiBkZWZhdWx0cztcbn1cblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBsZXhpdHlcbmFzeW5jIGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykge1xuICAvLyBDbG9uZSB0byBwcmV2ZW50IGludGVyZmVyZW5jZVxuICBvcHRpb25zID0gXy5jbG9uZURlZXAob3B0aW9ucyk7XG5cbiAgLy8gU2V0IGRlZXAgZGVmYXVsdHNcbiAgb3B0aW9ucyA9IF8uZGVmYXVsdHNEZWVwKG9wdGlvbnMsIGRlZmF1bHRzKTtcblxuICAvLyBFbnN1cmUgYHRleHRgIGlzIGEgc3RyaW5nXG4gIGlmICghXy5pc1N0cmluZyhvcHRpb25zLnRleHQpKSB0aHJvdyBuZXcgRXJyb3IoJ2B0ZXh0YCBtdXN0IGJlIGEgU3RyaW5nJyk7XG5cbiAgLy8gRW5zdXJlIGBmb250TmFtZU9yUGF0aGAgaXMgYSBzdHJpbmcgYW5kIG5vdCBibGFua1xuICBpZiAoIWlzU0FOQihvcHRpb25zLmZvbnROYW1lT3JQYXRoKSlcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2Bmb250TmFtZU9yUGF0aGAgbXVzdCBiZSBhIFN0cmluZyBhbmQgbm90IGJsYW5rJyk7XG5cbiAgLy8gQ29udmVydCBmb250IHNpemUgaW4gcGl4ZWxzIHRvIG51bWJlclxuICAvLyBhbmQgcmVtb3ZlIHB4LCBzbyB3ZSBqdXN0IGNvbnZlcnQgdG8gZGlnaXRzIG9ubHlcbiAgaWYgKF8uaXNTdHJpbmcob3B0aW9ucy5mb250U2l6ZSkpXG4gICAgb3B0aW9ucy5mb250U2l6ZSA9IHBhcnNlRmxvYXQob3B0aW9ucy5mb250U2l6ZSk7XG5cbiAgLy8gUm91bmQgdG8gbmVhcmVzdCB3aG9sZSBwaXhlbFxuICBvcHRpb25zLmZvbnRTaXplID0gTWF0aC5yb3VuZChvcHRpb25zLmZvbnRTaXplKTtcblxuICAvLyBFbnN1cmUgaXQncyBhIG51bWJlciBncmVhdGVyIHRoYW4gMFxuICBpZiAoIV8uaXNOdW1iZXIob3B0aW9ucy5mb250U2l6ZSkgfHwgb3B0aW9ucy5mb250U2l6ZSA8PSAwKVxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdgZm9udFNpemVgIG11c3QgYmUgYSBOdW1iZXIgb3IgU3RyaW5nIHRoYXQgaXMgYSB2YWxpZCBudW1iZXIgPiB0aGFuIDAnXG4gICAgKTtcblxuICAvLyBFbnN1cmUgYGZvbnRDb2xvcmAgaXMgYSBzdHJpbmdcbiAgaWYgKCFpc1NBTkIob3B0aW9ucy5mb250Q29sb3IpKVxuICAgIHRocm93IG5ldyBFcnJvcignYGZvbnRDb2xvcmAgbXVzdCBiZSBhIFN0cmluZyBhbmQgbm90IGJsYW5rJyk7XG5cbiAgLy8gRW5zdXJlIGBiYWNrZ3JvdW5kQ29sb3JgIGlzIGEgc3RyaW5nXG4gIGlmICghaXNTQU5CKG9wdGlvbnMuYmFja2dyb3VuZENvbG9yKSlcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2BiYWNrZ3JvdW5kQ29sb3JgIG11c3QgYmUgYSBTdHJpbmcgYW5kIG5vdCBibGFuaycpO1xuXG4gIC8vIEVuc3VyZSBzdXBwb3J0c0ZhbGxiYWNrIGlzIGEgYm9vbGVhbiBlbHNlIHRydWVcbiAgaWYgKCFfLmlzQm9vbGVhbihvcHRpb25zLnN1cHBvcnRzRmFsbGJhY2spKVxuICAgIHRocm93IG5ldyBFcnJvcignYHN1cHBvcnRzRmFsbGJhY2tgIG11c3QgYmUgYSBCb29sZWFuJyk7XG5cbiAgLy8gRW5zdXJlIHJlc2l6ZVRvRm9udFNpemUgaXMgYSBib29sZWFuIGVsc2UgdHJ1ZVxuICBpZiAoIV8uaXNCb29sZWFuKG9wdGlvbnMucmVzaXplVG9Gb250U2l6ZSkpXG4gICAgdGhyb3cgbmV3IEVycm9yKCdgcmVzaXplVG9Gb250U2l6ZWAgbXVzdCBiZSBhIEJvb2xlYW4nKTtcblxuICAvLyBFbnN1cmUgdHJpbSBpcyBhIGJvb2xlYW4gZWxzZSB0cnVlXG4gIGlmICghXy5pc0Jvb2xlYW4ob3B0aW9ucy50cmltKSkgdGhyb3cgbmV3IEVycm9yKCdgdHJpbWAgbXVzdCBiZSBhIEJvb2xlYW4nKTtcblxuICAvLyBFbnN1cmUgdHJpbVRvbGVyYW5jZSBpcyBhIG51bWJlciBlbHNlIDEwXG4gIGlmIChcbiAgICAhXy5pc051bWJlcihvcHRpb25zLnRyaW1Ub2xlcmFuY2UpIHx8XG4gICAgb3B0aW9ucy50cmltVG9sZXJhbmNlIDwgMSB8fFxuICAgIG9wdGlvbnMudHJpbVRvbGVyYW5jZSA+IDk5XG4gIClcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnYHRyaW1Ub2xlcmFuY2VgIG11c3QgYmUgYSBOdW1iZXIgYmV0d2VlbiAxIGFuZCA5OSBpbmNsdXNpdmUnXG4gICAgKTtcblxuICAvLyBJZiBgdGV4dFRvU3ZnLmF0dHJpYnV0ZXMuZmlsbGAgaXMgbm90IHNldFxuICAvLyB0aGVuIHNldCBpdCBlcXVhbCB0byBgZm9udENvbG9yYFxuICBpZiAoIV8uaXNTdHJpbmcob3B0aW9ucy50ZXh0VG9TdmcuYXR0cmlidXRlcy5maWxsKSlcbiAgICBvcHRpb25zLnRleHRUb1N2Zy5hdHRyaWJ1dGVzLmZpbGwgPSBvcHRpb25zLmZvbnRDb2xvcjtcblxuICAvLyBJZiBgdGV4dFRvU3ZnLmZvbnRTaXplYCBub3Qgc2V0LCB0aGVuIHdlIHdpbGwgY2FsY3VsYXRlXG4gIC8vIHdoYXQgdGhlIGBmb250U2l6ZWAgc2hvdWxkIGJlIGJhc2VkIG9mZiBoZWlnaHQgb2YgZm9udFxuICBpZiAoIV8uaXNOdW1iZXIob3B0aW9ucy50ZXh0VG9TdmcuZm9udFNpemUpKVxuICAgIG9wdGlvbnMudGV4dFRvU3ZnLmZvbnRTaXplID0gb3B0aW9ucy5mb250U2l6ZTtcblxuICAvLyBJZiBgZm9udE5hbWVPclBhdGhgIHdhcyBub3QgYSB2YWxpZCBmb250IHBhdGggKHdpdGggc21hcnQgZGV0ZWN0aW9uKVxuICAvLyB0aGVuIHJlc3VsdCB0byB1c2UgYGdldENsb3Nlc3RGb250TmFtZWAgYW5kIGBnZXRGb250UGF0aEJ5TmFtZWBcbiAgY29uc3QgZXh0ID0gcGF0aC5leHRuYW1lKG9wdGlvbnMuZm9udE5hbWVPclBhdGgpO1xuICBjb25zdCBmb250TmFtZSA9IHBhdGguYmFzZW5hbWUob3B0aW9ucy5mb250TmFtZU9yUGF0aCwgZXh0KTtcblxuICBpZiAoXy5pbmNsdWRlcyhmb250RXh0ZW5zaW9ucywgZXh0KSkge1xuICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgc3RhdChwYXRoLnJlc29sdmUob3B0aW9ucy5mb250TmFtZU9yUGF0aCkpO1xuICAgIGlmICghc3RhdHMuaXNGaWxlKCkpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGAke3BhdGgucmVzb2x2ZShvcHRpb25zLmZvbnROYW1lT3JQYXRoKX0gd2FzIG5vdCBhIHZhbGlkIGZpbGVgXG4gICAgICApO1xuXG4gICAgb3B0aW9ucy5mb250UGF0aCA9IHBhdGgucmVzb2x2ZShvcHRpb25zLmZvbnROYW1lT3JQYXRoKTtcbiAgICBvcHRpb25zLmZvbnROYW1lID0gZm9udE5hbWU7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgZm9udERpciA9IHBhdGguZGlybmFtZShwYXRoLnJlc29sdmUob3B0aW9ucy5mb250TmFtZU9yUGF0aCkpO1xuXG4gICAgbGV0IGRhdGEgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgIGZvbnRFeHRlbnNpb25zLm1hcChhc3luYyBleHQgPT4ge1xuICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGAke2ZvbnREaXJ9LyR7Zm9udE5hbWV9LiR7ZXh0fWA7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBzdGF0KGZpbGVQYXRoKTtcbiAgICAgICAgICByZXR1cm4gc3RhdHMuaXNGaWxlKCkgPyBmaWxlUGF0aCA6IGZhbHNlO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcblxuICAgIC8vIFJlbW92ZSBmYWxzZSBtYXRjaGVzXG4gICAgZGF0YSA9IF8uY29tcGFjdChkYXRhKTtcblxuICAgIC8vIElmIHRoaXMgd2FzIGEgZGlyZWN0b3J5IHBhdGggdGhlbiB0aHJvdyBhbiBlcnJvciB0aGF0IGl0IHdhcyBub3QgZm91bmRcbiAgICBpZiAob3B0aW9ucy5mb250TmFtZU9yUGF0aC5pbmNsdWRlcyhwYXRoLnNlcCkgJiYgZGF0YS5sZW5ndGggPT09IDApXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBcXGBmb250TmFtZU9yUGF0aFxcYCBcIiR7b3B0aW9ucy5mb250TmFtZU9yUGF0aH1cIiBmaWxlIHdhcyBub3QgZm91bmRgXG4gICAgICApO1xuXG4gICAgaWYgKGRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgb3B0aW9ucy5mb250TmFtZSA9IGZvbnROYW1lO1xuICAgICAgb3B0aW9ucy5mb250UGF0aCA9IGRhdGFbMF07XG4gICAgfSBlbHNlIHtcbiAgICAgIG9wdGlvbnMuZm9udE5hbWUgPSBhd2FpdCBnZXRDbG9zZXN0Rm9udE5hbWUob3B0aW9ucy5mb250TmFtZU9yUGF0aCk7XG4gICAgICBvcHRpb25zLmZvbnRQYXRoID0gYXdhaXQgZ2V0Rm9udFBhdGhCeU5hbWUob3B0aW9ucy5mb250TmFtZSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG5mdW5jdGlvbiByZW5kZXJGYWxsYmFjayh0ZXh0LCBmb250U2l6ZSwgZm9udENvbG9yLCBiYWNrZ3JvdW5kQ29sb3IsIGF0dHJzKSB7XG4gIGF0dHJzLnRpdGxlID0gdGV4dDtcbiAgYXR0cnMuYWx0ID0gdGV4dDtcbiAgYXR0cnMuc3R5bGUgPSBhdHRycy5zdHlsZSB8fCAnJztcbiAgYXR0cnMuc3R5bGUgKz0gYGNvbG9yOiAke2ZvbnRDb2xvcn07YDtcbiAgYXR0cnMuc3R5bGUgKz0gYGZvbnQtc2l6ZTogJHtmb250U2l6ZSAvIDJ9cHg7YDtcbiAgYXR0cnMuc3R5bGUgKz0gYGxpbmUtaGVpZ2h0OiAke2ZvbnRTaXplfXB4O2A7XG4gIGF0dHJzLnN0eWxlICs9ICd0ZXh0LWFsaWduOiBjZW50ZXI7JztcbiAgYXR0cnMuc3R5bGUgKz0gYGJhY2tncm91bmQtY29sb3I6ICR7YmFja2dyb3VuZENvbG9yfTtgO1xuICByZXR1cm4gYXR0cnM7XG59XG5cbmZ1bmN0aW9uIGFwcGx5QXR0cmlidXRlcygkZWwsIGF0dHJzKSB7XG4gIF8uZWFjaChfLmtleXMoYXR0cnMpLCBrZXkgPT4ge1xuICAgICRlbC5hdHRyKGtleSwgYXR0cnNba2V5XSk7XG4gIH0pO1xuICByZXR1cm4gJGVsO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdmcob3B0aW9ucykge1xuICBvcHRpb25zID0gYXdhaXQgc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgY29uc3QgaGFzaCA9IHJldmlzaW9uSGFzaChgc3ZnOiR7c2FmZVN0cmluZ2lmeShvcHRpb25zKX1gKTtcbiAgaWYgKGN1c3RvbUZvbnRzQ2FjaGVbaGFzaF0pIHtcbiAgICBkZWJ1ZyhgZm91bmQgY3VzdG9tRm9udHNDYWNoZSByZXN1bHQgZm9yICR7aGFzaH1gLCBjdXN0b21Gb250c0NhY2hlW2hhc2hdKTtcbiAgICByZXR1cm4gY3VzdG9tRm9udHNDYWNoZVtoYXNoXTtcbiAgfVxuXG4gIGNvbnN0IHRleHRUb1N2ZyA9IGF3YWl0IGxvYWQob3B0aW9ucy5mb250UGF0aCk7XG4gIGNvbnN0IHN0ciA9IHRleHRUb1N2Zy5nZXRTVkcob3B0aW9ucy50ZXh0LCBvcHRpb25zLnRleHRUb1N2Zyk7XG4gIGxldCAkc3ZnID0gJChzdHIpO1xuICBjb25zdCAkcmVjdCA9ICQoJzxyZWN0PicpO1xuICAkcmVjdC5hdHRyKCd3aWR0aCcsICRzdmcuYXR0cignd2lkdGgnKSk7XG4gICRyZWN0LmF0dHIoJ2hlaWdodCcsICRzdmcuYXR0cignaGVpZ2h0JykpO1xuICAkcmVjdC5hdHRyKCdmaWxsJywgb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IpO1xuICAkc3ZnLnByZXBlbmQoJHJlY3QpO1xuICAkc3ZnLmF0dHIoJ3dpZHRoJywgTWF0aC5yb3VuZChwYXJzZUZsb2F0KCRzdmcuYXR0cignd2lkdGgnKSkpKTtcbiAgJHN2Zy5hdHRyKCdoZWlnaHQnLCBNYXRoLnJvdW5kKHBhcnNlRmxvYXQoJHN2Zy5hdHRyKCdoZWlnaHQnKSkpKTtcbiAgJHN2Zy5hdHRyKCd2aWV3Qm94JywgYDAgMCAkeyRzdmcuYXR0cignd2lkdGgnKX0gJHskc3ZnLmF0dHIoJ2hlaWdodCcpfWApO1xuICAkc3ZnID0gYXBwbHlBdHRyaWJ1dGVzKCRzdmcsIG9wdGlvbnMuYXR0cnMpO1xuICBjb25zdCByZXN1bHQgPSAkLmh0bWwoJHN2Zyk7XG4gIGN1c3RvbUZvbnRzQ2FjaGVbaGFzaF0gPSByZXN1bHQ7XG4gIGRlYnVnKGBjYWNoaW5nIHJlc3VsdCBmb3IgJHtoYXNofWAsIGN1c3RvbUZvbnRzQ2FjaGVbaGFzaF0pO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5hc3luYyBmdW5jdGlvbiBpbWcob3B0aW9ucykge1xuICBvcHRpb25zID0gYXdhaXQgc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgY29uc3QgaGFzaCA9IHJldmlzaW9uSGFzaChgaW1nOiR7c2FmZVN0cmluZ2lmeShvcHRpb25zKX1gKTtcblxuICBpZiAoY3VzdG9tRm9udHNDYWNoZVtoYXNoXSkge1xuICAgIGRlYnVnKGBmb3VuZCBjdXN0b21Gb250c0NhY2hlIHJlc3VsdCBmb3IgJHtoYXNofWAsIGN1c3RvbUZvbnRzQ2FjaGVbaGFzaF0pO1xuICAgIHJldHVybiBjdXN0b21Gb250c0NhY2hlW2hhc2hdO1xuICB9XG5cbiAgY29uc3Qgc3RyID0gYXdhaXQgc3ZnKG9wdGlvbnMpO1xuICBjb25zdCAkc3ZnID0gJChzdHIpO1xuICBsZXQgJGltZyA9ICQoJzxpbWc+Jyk7XG4gICRpbWcuYXR0cignd2lkdGgnLCAkc3ZnLmF0dHIoJ3dpZHRoJykpO1xuICAkaW1nLmF0dHIoJ2hlaWdodCcsICRzdmcuYXR0cignaGVpZ2h0JykpO1xuICAkaW1nLmF0dHIoXG4gICAgJ3NyYycsXG4gICAgYGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJHtCdWZmZXIuZnJvbShzdHIsICd1dGY4JykudG9TdHJpbmcoJ2Jhc2U2NCcpfWBcbiAgKTtcbiAgaWYgKG9wdGlvbnMuc3VwcG9ydHNGYWxsYmFjaylcbiAgICBvcHRpb25zLmF0dHJzID0gcmVuZGVyRmFsbGJhY2soXG4gICAgICBvcHRpb25zLnRleHQsXG4gICAgICAkc3ZnLmF0dHIoJ2hlaWdodCcpLFxuICAgICAgb3B0aW9ucy5mb250Q29sb3IsXG4gICAgICBvcHRpb25zLmJhY2tncm91bmRDb2xvcixcbiAgICAgIG9wdGlvbnMuYXR0cnNcbiAgICApO1xuICAkaW1nID0gYXBwbHlBdHRyaWJ1dGVzKCRpbWcsIG9wdGlvbnMuYXR0cnMpO1xuICBjb25zdCByZXN1bHQgPSAkLmh0bWwoJGltZyk7XG4gIGN1c3RvbUZvbnRzQ2FjaGVbaGFzaF0gPSByZXN1bHQ7XG4gIGRlYnVnKGBjYWNoaW5nIHJlc3VsdCBmb3IgJHtoYXNofWAsIHJlc3VsdCk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHBuZyhvcHRpb25zLCBzY2FsZSkge1xuICAvLyBEZWZhdWx0IHNjYWxlIGl0IDFcbiAgc2NhbGUgPSBzY2FsZSB8fCAxO1xuXG4gIGlmICghXy5pc051bWJlcihzY2FsZSkpIHRocm93IG5ldyBFcnJvcignYHNjYWxlYCBtdXN0IGJlIGEgTnVtYmVyJyk7XG5cbiAgb3B0aW9ucyA9IGF3YWl0IHNldE9wdGlvbnMob3B0aW9ucyk7XG5cbiAgLy9cbiAgLy8gaW5pdGlhbGx5IEkgdHJpZWQgdG8gdXNlIHRoZSBwYWNrYWdlIGBzdmdvYFxuICAvLyB0byBvcHRpbWl6ZSB0aGUgaW1hZ2UgYW5kIHJlbW92ZSBpbnZpc2libGUgd2hpdGVzcGFjZVxuICAvLyBidXQgdGhpcyBmZWF0dXJlIGlzbid0IGF2YWlsYWJsZSB5ZXRcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3N2Zy9zdmdvL2lzc3Vlcy82N1xuICAvL1xuICAvLyBhbHNvIEkgdXNlZCBTaGFycCBkaXJlY3RseSwgYnV0IHRoZW4gY3JlYXRlZCBMaXBvXG4gIC8vIHRvIGFsbGV2aWF0ZSB0aGUgbmVlZCBmb3IgZGV2ZWxvcGVycyB0byBpbnN0YWxsIGxpYnZpcHMgb3Igd29ycnlcbiAgLy8gYWJvdXQgaW5zdGFsbGluZyBleHRyYSBkZXBlbmRlbmNpZXMgb24gdGhlaXIgc3lzdGVtXG4gIC8vIGJ1dCBzdGlsbCBhbGxvdyB0aGVtIHRvIHVzZSB0aGUgYnJpbGxpYW5jZSBvZiBTaGFycFxuICAvL1xuXG4gIGNvbnN0IHsgZm9udFNpemUgfSA9IG9wdGlvbnM7XG4gIG9wdGlvbnMuZm9udFNpemUgPSBNYXRoLnJvdW5kKGZvbnRTaXplICogc2NhbGUpO1xuICBvcHRpb25zLnRleHRUb1N2Zy5mb250U2l6ZSA9IG9wdGlvbnMuZm9udFNpemU7XG5cbiAgY29uc3QgaGFzaCA9IHJldmlzaW9uSGFzaChgcG5nOiR7c2FmZVN0cmluZ2lmeShvcHRpb25zKX1gKTtcblxuICBpZiAoY3VzdG9tRm9udHNDYWNoZVtoYXNoXSkge1xuICAgIGRlYnVnKGBmb3VuZCBjdXN0b21Gb250c0NhY2hlIHJlc3VsdCBmb3IgJHtoYXNofWAsIGN1c3RvbUZvbnRzQ2FjaGVbaGFzaF0pO1xuICAgIHJldHVybiBjdXN0b21Gb250c0NhY2hlW2hhc2hdO1xuICB9XG5cbiAgY29uc3Qgc3RyID0gYXdhaXQgc3ZnKG9wdGlvbnMpO1xuICBjb25zdCBidWYgPSBCdWZmZXIuZnJvbShzdHIsICd1dGY4Jyk7XG5cbiAgY29uc3QgZ2V0SW1hZ2UgPSBuZXcgTGlwbygpKGJ1Zik7XG5cbiAgaWYgKG9wdGlvbnMudHJpbSkgZ2V0SW1hZ2UudHJpbShvcHRpb25zLnRyaW1Ub2xlcmFuY2UpO1xuXG4gIGlmIChvcHRpb25zLnJlc2l6ZVRvRm9udFNpemUpXG4gICAgZ2V0SW1hZ2UucmVzaXplKG51bGwsIE1hdGgucm91bmQoZm9udFNpemUgKiBzY2FsZSkpO1xuXG4gIGNvbnN0IGltYWdlQnVmZmVyID0gYXdhaXQgZ2V0SW1hZ2UucG5nKCkudG9CdWZmZXIoKTtcblxuICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IG5ldyBMaXBvKCkoaW1hZ2VCdWZmZXIpLm1ldGFkYXRhKCk7XG5cbiAgbGV0ICRpbWcgPSAkKCc8aW1nPicpO1xuICAkaW1nLmF0dHIoJ3dpZHRoJywgTWF0aC5yb3VuZChtZXRhZGF0YS53aWR0aCAvIHNjYWxlKSk7XG4gICRpbWcuYXR0cignaGVpZ2h0JywgTWF0aC5yb3VuZChtZXRhZGF0YS5oZWlnaHQgLyBzY2FsZSkpO1xuICAkaW1nLmF0dHIoJ3NyYycsIGBkYXRhOmltYWdlL3BuZztiYXNlNjQsJHtpbWFnZUJ1ZmZlci50b1N0cmluZygnYmFzZTY0Jyl9YCk7XG4gIGlmIChvcHRpb25zLnN1cHBvcnRzRmFsbGJhY2spXG4gICAgb3B0aW9ucy5hdHRycyA9IHJlbmRlckZhbGxiYWNrKFxuICAgICAgb3B0aW9ucy50ZXh0LFxuICAgICAgTWF0aC5yb3VuZChtZXRhZGF0YS5oZWlnaHQgLyBzY2FsZSksXG4gICAgICBvcHRpb25zLmZvbnRDb2xvcixcbiAgICAgIG9wdGlvbnMuYmFja2dyb3VuZENvbG9yLFxuICAgICAgb3B0aW9ucy5hdHRyc1xuICAgICk7XG4gICRpbWcgPSBhcHBseUF0dHJpYnV0ZXMoJGltZywgb3B0aW9ucy5hdHRycyk7XG4gIGNvbnN0IHJlc3VsdCA9ICQuaHRtbCgkaW1nKTtcbiAgY3VzdG9tRm9udHNDYWNoZVtoYXNoXSA9IHJlc3VsdDtcbiAgZGVidWcoYGNhY2hpbmcgcmVzdWx0IGZvciAke2hhc2h9YCwgcmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcG5nMngob3B0aW9ucykge1xuICByZXR1cm4gcG5nKG9wdGlvbnMsIDIpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBwbmczeChvcHRpb25zKSB7XG4gIHJldHVybiBwbmcob3B0aW9ucywgMyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldENsb3Nlc3RGb250TmFtZShmb250TmFtZU9yUGF0aCkge1xuICBjb25zdCBoYXNoID0gYGNsb3Nlc3RGb250TmFtZSgke2ZvbnROYW1lT3JQYXRofSlgO1xuICBpZiAoY3VzdG9tRm9udHNDYWNoZVtoYXNoXSkgcmV0dXJuIGN1c3RvbUZvbnRzQ2FjaGVbaGFzaF07XG4gIGNvbnN0IGZvbnROYW1lcyA9IGF3YWl0IGdldEF2YWlsYWJsZUZvbnROYW1lcygpO1xuICBjb25zdCBmb250TmFtZXNCeURpc3RhbmNlID0gXy5zb3J0QnkoXG4gICAgXy5tYXAoZm9udE5hbWVzLCBuYW1lID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGRpc3RhbmNlOiBsZXZlbnNodGVpbi5nZXQoXG4gICAgICAgICAgZm9udE5hbWVPclBhdGgudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICBuYW1lLnRvTG93ZXJDYXNlKClcbiAgICAgICAgKVxuICAgICAgfTtcbiAgICB9KSxcbiAgICBbJ2Rpc3RhbmNlJywgJ25hbWUnXVxuICApO1xuICAvLyBJZiB0aGVyZSB3ZXJlIG5vIG1hdGNoZXMgb3IgaWYgdGhlIGRpc3RhbmNlXG4gIC8vIG9mIGNoYXJhY3RlciBkaWZmZXJlbmNlIGlzIDUwJSBkaWZmZXJlbnRcbiAgLy8gdGhhbiBhY3R1YWwgbGVuZ3RoIG9mIHRoZSBmb250IG5hbWUsIHRoZW4gcmVqZWN0IGl0XG4gIGlmIChcbiAgICBmb250TmFtZXNCeURpc3RhbmNlLmxlbmd0aCA9PT0gMCB8fFxuICAgIGZvbnROYW1lc0J5RGlzdGFuY2VbMF0uZGlzdGFuY2UgPiBmb250TmFtZU9yUGF0aC5sZW5ndGggLyAyXG4gIClcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgXCIke2ZvbnROYW1lT3JQYXRofVwiIHdhcyBub3QgZm91bmQsIGRpZCB5b3UgZm9yZ2V0IHRvIGluc3RhbGwgaXQ/YFxuICAgICk7XG4gIGN1c3RvbUZvbnRzQ2FjaGVbaGFzaF0gPSBmb250TmFtZXNCeURpc3RhbmNlWzBdLm5hbWU7XG4gIHJldHVybiBmb250TmFtZXNCeURpc3RhbmNlWzBdLm5hbWU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEZvbnRQYXRoQnlOYW1lKG5hbWUpIHtcbiAgY29uc3QgaGFzaCA9IGBmb250UGF0aEJ5TmFtZSgke25hbWV9KWA7XG4gIGlmIChjdXN0b21Gb250c0NhY2hlW2hhc2hdKSByZXR1cm4gY3VzdG9tRm9udHNDYWNoZVtoYXNoXTtcbiAgY29uc3QgZm9udFBhdGhzQnlOYW1lID0gYXdhaXQgZ2V0Rm9udFBhdGhzQnlOYW1lKCk7XG4gIGN1c3RvbUZvbnRzQ2FjaGVbaGFzaF0gPSBmb250UGF0aHNCeU5hbWVbbmFtZV07XG4gIHJldHVybiBmb250UGF0aHNCeU5hbWVbbmFtZV07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEZvbnRQYXRoc0J5TmFtZSgpIHtcbiAgaWYgKGN1c3RvbUZvbnRzQ2FjaGUuZm9udFBhdGhzQnlOYW1lKSByZXR1cm4gY3VzdG9tRm9udHNDYWNoZS5mb250UGF0aHNCeU5hbWU7XG4gIGNvbnN0IGZvbnROYW1lcyA9IGF3YWl0IGdldEF2YWlsYWJsZUZvbnROYW1lcygpO1xuICBjb25zdCBmb250UGF0aHMgPSBhd2FpdCBnZXRBdmFpbGFibGVGb250UGF0aHMoKTtcbiAgY29uc3QgZm9udFBhdGhzQnlOYW1lID0gXy56aXBPYmplY3QoZm9udE5hbWVzLCBmb250UGF0aHMpO1xuICBjdXN0b21Gb250c0NhY2hlLmZvbnRQYXRoc0J5TmFtZSA9IGZvbnRQYXRoc0J5TmFtZTtcbiAgcmV0dXJuIGZvbnRQYXRoc0J5TmFtZTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlRm9udFBhdGhzKCkge1xuICBpZiAoY3VzdG9tRm9udHNDYWNoZS5mb250UGF0aHMpIHJldHVybiBjdXN0b21Gb250c0NhY2hlLmZvbnRQYXRocztcbiAgbGV0IGZvbnRzID0gYXdhaXQgUHJvbWlzZS5hbGwodXNlVHlwZXMubWFwKHR5cGUgPT4gb3NGb250cy5nZXRBbGwodHlwZSkpKTtcbiAgZm9udHMgPSBfLmZsYXR0ZW4oZm9udHMpO1xuICBjb25zdCBhcnIgPSBbXTtcbiAgLy8gYWRkIGZvbnRzIGZyb20gc3lzdGVtXG4gIGZvciAoY29uc3QgZWxlbWVudCBvZiBmb250cykge1xuICAgIGxldCBleHQgPSBwYXRoLmV4dG5hbWUoZWxlbWVudCk7XG4gICAgaWYgKGV4dC5pbmRleE9mKCcuJykgPT09IDApIGV4dCA9IGV4dC5zbGljZSgxKTtcbiAgICBpZiAoZm9udEV4dGVuc2lvbnMuaW5jbHVkZXMoZXh0KSkgYXJyLnB1c2goZWxlbWVudCk7XG4gIH1cblxuICAvLyBhZGQgbm9kZV9tb2R1bGVzIGZvbGRlclxuICBjb25zdCBub2RlTW9kdWxlRm9udHMgPSBhd2FpdCBvc0ZvbnRzLmdldEZvbnRzSW5EaXJlY3RvcnkoXG4gICAgcGF0aC5qb2luKHBrZ0Rpci5zeW5jKCksICdub2RlX21vZHVsZXMnKVxuICApO1xuICBmb3IgKGNvbnN0IGVsZW1lbnQgb2Ygbm9kZU1vZHVsZUZvbnRzKSB7XG4gICAgbGV0IGV4dCA9IHBhdGguZXh0bmFtZShlbGVtZW50KTtcbiAgICBpZiAoZXh0LmluZGV4T2YoJy4nKSA9PT0gMCkgZXh0ID0gZXh0LnNsaWNlKDEpO1xuICAgIGlmIChmb250RXh0ZW5zaW9ucy5pbmNsdWRlcyhleHQpKSBhcnIucHVzaChlbGVtZW50KTtcbiAgfVxuXG4gIC8vIFNvcnQgdGhlIGZvbnRzIEEtWlxuICBjb25zdCBmb250UGF0aHMgPSBhcnIuc29ydCgpO1xuICBjdXN0b21Gb250c0NhY2hlLmZvbnRQYXRocyA9IGZvbnRQYXRocztcbiAgcmV0dXJuIGZvbnRQYXRocztcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlRm9udE5hbWVzKCkge1xuICBpZiAoY3VzdG9tRm9udHNDYWNoZS5mb250TmFtZXMpIHJldHVybiBjdXN0b21Gb250c0NhY2hlLmZvbnROYW1lcztcbiAgY29uc3QgZm9udFBhdGhzID0gYXdhaXQgZ2V0QXZhaWxhYmxlRm9udFBhdGhzKCk7XG4gIGNvbnN0IGZvbnROYW1lcyA9IF8ubWFwKGZvbnRQYXRocywgZm9udFBhdGggPT5cbiAgICBwYXRoLmJhc2VuYW1lKGZvbnRQYXRoLCBwYXRoLmV4dG5hbWUoZm9udFBhdGgpKVxuICApO1xuICBjdXN0b21Gb250c0NhY2hlLmZvbnROYW1lcyA9IGZvbnROYW1lcztcbiAgcmV0dXJuIGZvbnROYW1lcztcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHNldERlZmF1bHRzLFxuICBzZXRPcHRpb25zLFxuICBzdmcsXG4gIGltZyxcbiAgcG5nLFxuICBwbmcyeCxcbiAgcG5nM3gsXG4gIGdldENsb3Nlc3RGb250TmFtZSxcbiAgZ2V0Rm9udFBhdGhzQnlOYW1lLFxuICBnZXRGb250UGF0aEJ5TmFtZSxcbiAgZ2V0QXZhaWxhYmxlRm9udFBhdGhzLFxuICBnZXRBdmFpbGFibGVGb250TmFtZXMsXG4gIGN1c3RvbUZvbnRzQ2FjaGVcbn07XG4iXX0=